"use strict";function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(b,!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(b).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}var intervals=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],scalesMap={},degreesMap={major:{id:"major",degrees:[2,2,1,2,2,2,1]},minor:{id:"minor",degrees:[2,1,2,2,1,2,2]}},selectedKey=intervals[0],selectedScaleDegrees=degreesMap.major,selectedScale=null,stringsArray=[],shapeNotes=[],selectedShape={index:0,fret:0,number:0},isPortrait=!1;function buildScale(a){var b=[],c=intervals.indexOf(a),d=!0,e=!1,f=void 0;try{for(var g,h,j=selectedScaleDegrees.degrees[Symbol.iterator]();!(d=(g=j.next()).done);d=!0){if(h=g.value,!intervals[c+h]){var k=c===intervals.length-1&&2===h?1:0;c=k,b=[].concat(_toConsumableArray(b),[intervals[k]]);continue}b=[].concat(_toConsumableArray(b),[intervals[c+h]]),c+=h}}catch(a){e=!0,f=a}finally{try{d||null==j["return"]||j["return"]()}finally{if(e)throw f}}return b}function buildScalesMap(){var a=!0,b=!1,c=void 0;try{for(var d,e,f=intervals[Symbol.iterator]();!(a=(d=f.next()).done);a=!0)e=d.value,scalesMap=_objectSpread({},scalesMap,_defineProperty({},e,{id:e,notes:buildScale(e)}))}catch(a){b=!0,c=a}finally{try{a||null==f["return"]||f["return"]()}finally{if(b)throw c}}selectedScale=scalesMap[selectedKey]}buildScalesMap();function getNotesOfString(a){for(var b=[],c=11===intervals.indexOf(a)?0:intervals.indexOf(a)+1;11>=b.length;)intervals[c]||(c=0),b=[].concat(_toConsumableArray(b),[intervals[c]]),c++;return b}function buildFretboard(a){var b=a.portrait,c=[intervals[4],intervals[9],intervals[2],intervals[7],intervals[11],intervals[4]];stringsArray=[];var d=!0===b?[].concat(c):[].concat(c).reverse();document.getElementById("fretBoard").innerHTML="<div class=\"frets-edge\">".concat(buildFrets(),"</div> \n    ").concat(d.map(function(a,b){return"".concat(buildString(a,b)," ").concat(5>b?"<div class=\"frets\">".concat(buildFrets(b),"</div>"):"")}).join("")," \n    <div class=\"frets-edge\">").concat(buildFrets(),"</div>\n    </div>");var e=[],f=[1,7,6,5,4,3,2],g=1;shapeNotes=[],stringsArray[0].forEach(function(a,b){var c=stringsArray[0].indexOf(stringsArray[0].find(function(a){return a.note===selectedKey})),d=null;if(0===b)return g=f[c],d={fret:a.fret,number:f[c],index:c,note:a.note},void(e=[d]);var h=f.indexOf(g)-1;g=f[h],d={fret:a.fret,number:g,index:h,note:a.note},h=f.length-1,g===void 0&&(g=f[h],d={fret:a.fret,number:g,index:h,note:a.note}),e=[].concat(_toConsumableArray(e),[d])}),e.forEach(function(a,c){var d=b?_toConsumableArray(stringsArray):_toConsumableArray(stringsArray).reverse();d.map(function(b,d){var e=[],f=!0,g=b.indexOf(b.find(function(b){return b.fret===a.fret}));if(-1===g&&(f=!1,g=b.indexOf(b.find(function(b){return b.fret===a.fret+1}))),4===d||5===d){var h=f?g+1:g;e=b.slice(h,h+3)}else e=b.slice(g,g+3);return shapeNotes[c]?void(shapeNotes[c]=[].concat(_toConsumableArray(shapeNotes[c]),_toConsumableArray(e))):void(shapeNotes[c]=e)})}),buildShapeSelect(e),shapeNotes[selectedShape.index].map(function(a){document.getElementById(a.id).className="highlight"})}var buildFrets=function(a){for(var b="",c=0;12>c;c++)b+="<div class=\"fret\">".concat(2===a&&(4===c||6===c||8===c)||11===c&&(0===a||4===a)?"<div class=\"fret-dot\"></div>":"","</div>");return b},buildString=function(a,b){var c=getNotesOfString(a).map(function(a,c){return{id:b+a,note:a,stringNumber:b,fret:c}});stringsArray=[].concat(_toConsumableArray(stringsArray),[c.filter(function(a){return selectedScale.notes.includes(a.note)})]);var d=isPortrait?0:5;return"<div class=\"guitar-string\">".concat(c.map(function(a){return b===d?"<div class=\"root-note\">".concat(selectedScale.notes.includes(a.note)?"<button rootNoteFret=\"".concat(a.fret,"\" class=\"root-note-text-backdrop shape-select root-note-shape-select ").concat(selectedShape.note===a.note?"selected-root-note":"","\"></button><span class=\"root-note-text\"><p id=").concat(a.id,">").concat(a.note,"</p></span>"):"","</div>"):"<div class=\"note\">".concat(selectedScale.notes.includes(a.note)?"<div class=\"note-text-backdrop\"></div><span class=\"note-text\"><p id=".concat(a.id,">").concat(a.note,"</p></span>"):"","</div>")}).join(""),"</div>")};function buildKeySelector(){var a=[];for(var c in scalesMap)a=[].concat(_toConsumableArray(a),["<option value=\"".concat(c,"\">").concat(c,"</option>")]);var b=document.getElementById("keySelect");b.innerHTML=a.join(),b.value=selectedKey}function buildScaleSelector(){var a=[];for(var c in degreesMap)a=[].concat(_toConsumableArray(a),["<option value=\"".concat(c,"\">").concat(c,"</option>")]);var b=document.getElementById("scaleSelect");b.innerHTML=a.join(),b.value=selectedScaleDegrees.id}function buildShapeSelect(a){a.forEach(function(a,b){+b===+selectedShape.index&&(selectedShape=a,selectedShape.index=b)}),document.getElementById("shape-select").innerHTML=a.map(function(a,b){return"<button \n    shapeIndex=".concat(b,"\n    shapeFret=").concat(a.fret," \n    class=\"shape-select ").concat(+selectedShape.index===+b?"selected-shape":"","\">\n    ").concat(a.number,"\n  </button>")}).join(""),document.querySelectorAll("[rootNoteFret]").forEach(function(b){var c=null,d=null;a.forEach(function(a,e){if(+b.getAttribute("rootNoteFret")===+a.fret)return c=a,d=e,e===selectedShape.index?void b.classList.add("selected-root-note"):void b.classList.remove("selected-root-note")}),b.setAttribute("shapeIndex",d),b.setAttribute("shapeNumber",c.number),b.setAttribute("shapeNote",c.note)}),document.querySelectorAll(".shape-select","[rootNoteFret]").forEach(function(a){return a.addEventListener("click",function(a){selectedShape={index:a.target.getAttribute("shapeIndex"),number:a.target.getAttribute("shapeNumber"),fret:a.target.getAttribute("rootNoteFret")?a.target.getAttribute("rootNoteFret"):a.target.getAttribute("shapeFret"),note:a.target.getAttribute("shapeNote")},buildFretboard({portrait:isPortrait})})})}function reDrawApp(){return buildScalesMap(),buildKeySelector(),buildScaleSelector(),window.innerHeight>window.innerWidth?(document.getElementById("wrapper").className="app-wrapper portrait-mode",isPortrait=!0,void buildFretboard({portrait:!0})):void(isPortrait=!1,document.getElementById("wrapper").className="app-wrapper landscape-mode",buildFretboard({portrait:!1}))}window.addEventListener("resize",function(){reDrawApp()}),document.getElementById("keySelect").addEventListener("change",function(a){selectedKey=a.target.value,document.getElementById("keySelect").value=a.target.value,reDrawApp()}),document.getElementById("scaleSelect").addEventListener("change",function(a){selectedScaleDegrees=degreesMap[a.target.value],document.getElementById("scaleSelect").value=a.target.value,reDrawApp()}),reDrawApp(),document.getElementById("fullScreen").addEventListener("click",function(){screenfull.isEnabled&&screenfull.toggle()});

//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBdUMsS0FBdkMsQ0FBK0MsQ0FBQyxDQUFDLE1BQUYsQ0FBUyxLQUZhLENBSXJFLFNBQVMsRUFDVixDQUxELEMsQ0FPQSxTQUFTLEUsQ0FFVCxRQUFRLENBQUMsY0FBVCxDQUF3QixZQUF4QixFQUFzQyxnQkFBdEMsQ0FBdUQsT0FBdkQsQ0FBZ0UsVUFBSyxDQUM5RCxVQUFVLENBQUMsU0FEbUQsRUFJbkUsVUFBVSxDQUFDLE1BQVgsRUFDRCxDQUxELEMiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBpbnRlcnZhbHMgPSBbXG4gICdDJyxcbiAgJ0MjJyxcbiAgJ0QnLFxuICAnRCMnLFxuICAnRScsXG4gICdGJyxcbiAgJ0YjJyxcbiAgJ0cnLFxuICAnRyMnLFxuICAnQScsXG4gICdBIycsXG4gICdCJ1xuXTtcblxubGV0IHNjYWxlc01hcCA9IHt9O1xuXG5jb25zdCBkZWdyZWVzTWFwID0ge1xuICBtYWpvcjogeyBpZDogJ21ham9yJywgZGVncmVlczogWzIsIDIsIDEsIDIsIDIsIDIsIDFdIH0sXG4gIG1pbm9yOiB7IGlkOiAnbWlub3InLCBkZWdyZWVzOiBbMiwgMSwgMiwgMiwgMSwgMiwgMl0gfVxufTtcblxubGV0IHNlbGVjdGVkS2V5ID0gaW50ZXJ2YWxzWzBdO1xubGV0IHNlbGVjdGVkU2NhbGVEZWdyZWVzID0gZGVncmVlc01hcC5tYWpvcjtcbmxldCBzZWxlY3RlZFNjYWxlID0gbnVsbDtcblxubGV0IHN0cmluZ3NBcnJheSA9IFtdO1xubGV0IHNoYXBlTm90ZXMgPSBbXTtcbmxldCBzZWxlY3RlZFNoYXBlID0geyBpbmRleDogMCwgZnJldDogMCwgbnVtYmVyOiAwIH07XG5cbmxldCBpc1BvcnRyYWl0ID0gZmFsc2U7XG5cbmZ1bmN0aW9uIGJ1aWxkU2NhbGUocm9vdE5vdGUpIHtcbiAgbGV0IHNjYWxlID0gW107XG5cbiAgbGV0IGkgPSBpbnRlcnZhbHMuaW5kZXhPZihyb290Tm90ZSk7XG4gIGZvciAoY29uc3QgZGVncmVlIG9mIHNlbGVjdGVkU2NhbGVEZWdyZWVzLmRlZ3JlZXMpIHtcbiAgICBpZiAoIWludGVydmFsc1tpICsgZGVncmVlXSkge1xuICAgICAgbGV0IHN0YXJ0SW5kZXggPSBpID09PSBpbnRlcnZhbHMubGVuZ3RoIC0gMSAmJiBkZWdyZWUgPT09IDIgPyAxIDogMDtcbiAgICAgIGkgPSBzdGFydEluZGV4O1xuICAgICAgc2NhbGUgPSBbLi4uc2NhbGUsIGludGVydmFsc1tzdGFydEluZGV4XV07XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBzY2FsZSA9IFsuLi5zY2FsZSwgaW50ZXJ2YWxzW2kgKyBkZWdyZWVdXTtcblxuICAgIGkgKz0gZGVncmVlO1xuICB9XG4gIHJldHVybiBzY2FsZTtcbn1cblxuZnVuY3Rpb24gYnVpbGRTY2FsZXNNYXAoKSB7XG4gIGZvciAobGV0IGludGVydmFsIG9mIGludGVydmFscykge1xuICAgIHNjYWxlc01hcCA9IHtcbiAgICAgIC4uLnNjYWxlc01hcCxcbiAgICAgIFtpbnRlcnZhbF06IHsgaWQ6IGludGVydmFsLCBub3RlczogYnVpbGRTY2FsZShpbnRlcnZhbCkgfVxuICAgIH07XG4gIH1cbiAgc2VsZWN0ZWRTY2FsZSA9IHNjYWxlc01hcFtzZWxlY3RlZEtleV07XG59XG5cbmJ1aWxkU2NhbGVzTWFwKCk7XG5cbmZ1bmN0aW9uIGdldE5vdGVzT2ZTdHJpbmcoc3RhcnRpbmdOb3RlKSB7XG4gIGxldCBub3RlcyA9IFtdO1xuICBsZXQgaSA9XG4gICAgaW50ZXJ2YWxzLmluZGV4T2Yoc3RhcnRpbmdOb3RlKSA9PT0gMTFcbiAgICAgID8gMFxuICAgICAgOiBpbnRlcnZhbHMuaW5kZXhPZihzdGFydGluZ05vdGUpICsgMTtcblxuICB3aGlsZSAobm90ZXMubGVuZ3RoIDw9IDExKSB7XG4gICAgaWYgKCFpbnRlcnZhbHNbaV0pIHtcbiAgICAgIGkgPSAwO1xuICAgIH1cbiAgICBub3RlcyA9IFsuLi5ub3RlcywgaW50ZXJ2YWxzW2ldXTtcbiAgICBpKys7XG4gIH1cblxuICByZXR1cm4gbm90ZXM7XG59XG5cbmZ1bmN0aW9uIGJ1aWxkRnJldGJvYXJkKHsgcG9ydHJhaXQgfSkge1xuICBjb25zdCBzdGFuZGFyZFR1bmluZ05vdGVzID0gW1xuICAgIGludGVydmFsc1s0XSxcbiAgICBpbnRlcnZhbHNbOV0sXG4gICAgaW50ZXJ2YWxzWzJdLFxuICAgIGludGVydmFsc1s3XSxcbiAgICBpbnRlcnZhbHNbMTFdLFxuICAgIGludGVydmFsc1s0XVxuICBdO1xuICBzdHJpbmdzQXJyYXkgPSBbXTtcbiAgY29uc3Qgc3RhcnRpbmdOb3RlcyA9XG4gICAgcG9ydHJhaXQgPT09IHRydWVcbiAgICAgID8gWy4uLnN0YW5kYXJkVHVuaW5nTm90ZXNdXG4gICAgICA6IFsuLi5zdGFuZGFyZFR1bmluZ05vdGVzXS5yZXZlcnNlKCk7XG5cbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXG4gICAgJ2ZyZXRCb2FyZCdcbiAgKS5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz1cImZyZXRzLWVkZ2VcIj4ke2J1aWxkRnJldHMoKX08L2Rpdj4gXG4gICAgJHtzdGFydGluZ05vdGVzXG4gICAgICAubWFwKFxuICAgICAgICAoc3RhcnRpbmdOb3RlLCBzdHJpbmdOdW1iZXIpID0+XG4gICAgICAgICAgYCR7YnVpbGRTdHJpbmcoc3RhcnRpbmdOb3RlLCBzdHJpbmdOdW1iZXIpfSAke1xuICAgICAgICAgICAgc3RyaW5nTnVtYmVyIDwgNVxuICAgICAgICAgICAgICA/IGA8ZGl2IGNsYXNzPVwiZnJldHNcIj4ke2J1aWxkRnJldHMoc3RyaW5nTnVtYmVyKX08L2Rpdj5gXG4gICAgICAgICAgICAgIDogJydcbiAgICAgICAgICB9YFxuICAgICAgKVxuICAgICAgLmpvaW4oJycpfSBcbiAgICA8ZGl2IGNsYXNzPVwiZnJldHMtZWRnZVwiPiR7YnVpbGRGcmV0cygpfTwvZGl2PlxuICAgIDwvZGl2PmA7XG5cbiAgbGV0IHNoYXBlcyA9IFtdO1xuICBjb25zdCBzaGFwZU51bWJlcnMgPSBbMSwgNywgNiwgNSwgNCwgMywgMl07XG4gIGxldCBjdXJyZW50U2hhcGVOdW1iZXIgPSAxO1xuXG4gIHNoYXBlTm90ZXMgPSBbXTtcblxuICBzdHJpbmdzQXJyYXlbMF0uZm9yRWFjaCgobm90ZSwgbm90ZUluZGV4KSA9PiB7XG4gICAgY29uc3Qgcm9vdE5vdGVJbmRleCA9IHN0cmluZ3NBcnJheVswXS5pbmRleE9mKFxuICAgICAgc3RyaW5nc0FycmF5WzBdLmZpbmQobm90ZSA9PiBub3RlLm5vdGUgPT09IHNlbGVjdGVkS2V5KVxuICAgICk7XG5cbiAgICBsZXQgY3VycmVudFNoYXBlID0gbnVsbDtcblxuICAgIGlmIChub3RlSW5kZXggPT09IDApIHtcbiAgICAgIGN1cnJlbnRTaGFwZU51bWJlciA9IHNoYXBlTnVtYmVyc1tyb290Tm90ZUluZGV4XTtcbiAgICAgIGN1cnJlbnRTaGFwZSA9IHtcbiAgICAgICAgZnJldDogbm90ZS5mcmV0LFxuICAgICAgICBudW1iZXI6IHNoYXBlTnVtYmVyc1tyb290Tm90ZUluZGV4XSxcbiAgICAgICAgaW5kZXg6IHJvb3ROb3RlSW5kZXgsXG4gICAgICAgIG5vdGU6IG5vdGUubm90ZVxuICAgICAgfTtcbiAgICAgIHNoYXBlcyA9IFtjdXJyZW50U2hhcGVdO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxldCBpbmRleCA9IHNoYXBlTnVtYmVycy5pbmRleE9mKGN1cnJlbnRTaGFwZU51bWJlcikgLSAxO1xuICAgIGN1cnJlbnRTaGFwZU51bWJlciA9IHNoYXBlTnVtYmVyc1tpbmRleF07XG4gICAgY3VycmVudFNoYXBlID0ge1xuICAgICAgZnJldDogbm90ZS5mcmV0LFxuICAgICAgbnVtYmVyOiBjdXJyZW50U2hhcGVOdW1iZXIsXG4gICAgICBpbmRleCxcbiAgICAgIG5vdGU6IG5vdGUubm90ZVxuICAgIH07XG5cbiAgICBpbmRleCA9IHNoYXBlTnVtYmVycy5sZW5ndGggLSAxO1xuICAgIGlmIChjdXJyZW50U2hhcGVOdW1iZXIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgY3VycmVudFNoYXBlTnVtYmVyID0gc2hhcGVOdW1iZXJzW2luZGV4XTtcbiAgICAgIGN1cnJlbnRTaGFwZSA9IHtcbiAgICAgICAgZnJldDogbm90ZS5mcmV0LFxuICAgICAgICBudW1iZXI6IGN1cnJlbnRTaGFwZU51bWJlcixcbiAgICAgICAgaW5kZXgsXG4gICAgICAgIG5vdGU6IG5vdGUubm90ZVxuICAgICAgfTtcbiAgICB9XG5cbiAgICBzaGFwZXMgPSBbLi4uc2hhcGVzLCBjdXJyZW50U2hhcGVdO1xuICB9KTtcblxuICBzaGFwZXMuZm9yRWFjaCgoc2hhcGUsIHNoYXBlSW5kZXgpID0+IHtcbiAgICBsZXQgc3RyaW5ncyA9IHBvcnRyYWl0ID8gWy4uLnN0cmluZ3NBcnJheV0gOiBbLi4uc3RyaW5nc0FycmF5XS5yZXZlcnNlKCk7XG4gICAgc3RyaW5ncy5tYXAoKHN0cmluZywgc3RyaW5nTnVtYmVyKSA9PiB7XG4gICAgICBsZXQgbm90ZXMgPSBbXTtcbiAgICAgIGxldCBvblJvb3RGcmV0ID0gdHJ1ZTtcbiAgICAgIGxldCBub3RlT25TaGFwZVN0YXJ0RnJldCA9IHN0cmluZy5pbmRleE9mKFxuICAgICAgICBzdHJpbmcuZmluZChub3RlID0+IG5vdGUuZnJldCA9PT0gc2hhcGUuZnJldClcbiAgICAgICk7XG4gICAgICBpZiAobm90ZU9uU2hhcGVTdGFydEZyZXQgPT09IC0xKSB7XG4gICAgICAgIG9uUm9vdEZyZXQgPSBmYWxzZTtcbiAgICAgICAgbm90ZU9uU2hhcGVTdGFydEZyZXQgPSBzdHJpbmcuaW5kZXhPZihcbiAgICAgICAgICBzdHJpbmcuZmluZChub3RlID0+IG5vdGUuZnJldCA9PT0gc2hhcGUuZnJldCArIDEpXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGlmIChzdHJpbmdOdW1iZXIgPT09IDQgfHwgc3RyaW5nTnVtYmVyID09PSA1KSB7XG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gb25Sb290RnJldFxuICAgICAgICAgID8gbm90ZU9uU2hhcGVTdGFydEZyZXQgKyAxXG4gICAgICAgICAgOiBub3RlT25TaGFwZVN0YXJ0RnJldDtcbiAgICAgICAgbm90ZXMgPSBzdHJpbmcuc2xpY2Uoc3RhcnQsIHN0YXJ0ICsgMyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBub3RlcyA9IHN0cmluZy5zbGljZShub3RlT25TaGFwZVN0YXJ0RnJldCwgbm90ZU9uU2hhcGVTdGFydEZyZXQgKyAzKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFzaGFwZU5vdGVzW3NoYXBlSW5kZXhdKSB7XG4gICAgICAgIHNoYXBlTm90ZXNbc2hhcGVJbmRleF0gPSBub3RlcztcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgc2hhcGVOb3Rlc1tzaGFwZUluZGV4XSA9IFsuLi5zaGFwZU5vdGVzW3NoYXBlSW5kZXhdLCAuLi5ub3Rlc107XG4gICAgfSk7XG4gIH0pO1xuXG4gIGJ1aWxkU2hhcGVTZWxlY3Qoc2hhcGVzKTtcblxuICBzaGFwZU5vdGVzW3NlbGVjdGVkU2hhcGUuaW5kZXhdLm1hcChub3RlID0+IHtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChub3RlLmlkKS5jbGFzc05hbWUgPSAnaGlnaGxpZ2h0JztcbiAgfSk7XG59XG5cbmNvbnN0IGJ1aWxkRnJldHMgPSBzdHJpbmdOdW1iZXIgPT4ge1xuICBsZXQgZnJldHMgPSBgYDtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMjsgaSsrKSB7XG4gICAgZnJldHMgKz0gYDxkaXYgY2xhc3M9XCJmcmV0XCI+JHtcbiAgICAgIChzdHJpbmdOdW1iZXIgPT09IDIgJiYgKGkgPT09IDQgfHwgaSA9PT0gNiB8fCBpID09PSA4KSkgfHxcbiAgICAgIChpID09PSAxMSAmJiAoc3RyaW5nTnVtYmVyID09PSAwIHx8IHN0cmluZ051bWJlciA9PT0gNCkpXG4gICAgICAgID8gYDxkaXYgY2xhc3M9XCJmcmV0LWRvdFwiPjwvZGl2PmBcbiAgICAgICAgOiAnJ1xuICAgIH08L2Rpdj5gO1xuICB9XG4gIHJldHVybiBmcmV0cztcbn07XG5cbmNvbnN0IGJ1aWxkU3RyaW5nID0gKHN0YXJ0aW5nTm90ZSwgc3RyaW5nTnVtYmVyKSA9PiB7XG4gIGNvbnN0IHN0cmluZ05vdGVzID0gZ2V0Tm90ZXNPZlN0cmluZyhzdGFydGluZ05vdGUpLm1hcCgobm90ZSwgZnJldCkgPT4gKHtcbiAgICBpZDogc3RyaW5nTnVtYmVyICsgbm90ZSxcbiAgICBub3RlLFxuICAgIHN0cmluZ051bWJlcixcbiAgICBmcmV0XG4gIH0pKTtcbiAgc3RyaW5nc0FycmF5ID0gW1xuICAgIC4uLnN0cmluZ3NBcnJheSxcbiAgICBzdHJpbmdOb3Rlcy5maWx0ZXIobm90ZSA9PiBzZWxlY3RlZFNjYWxlLm5vdGVzLmluY2x1ZGVzKG5vdGUubm90ZSkpXG4gIF07XG5cbiAgY29uc3QgbG93RSA9IGlzUG9ydHJhaXQgPyAwIDogNTtcblxuICByZXR1cm4gYDxkaXYgY2xhc3M9XCJndWl0YXItc3RyaW5nXCI+JHtzdHJpbmdOb3Rlc1xuICAgIC5tYXAoKG5vdGUsIG5vdGVJbmRleCkgPT5cbiAgICAgIHN0cmluZ051bWJlciAhPT0gbG93RVxuICAgICAgICA/IGA8ZGl2IGNsYXNzPVwibm90ZVwiPiR7XG4gICAgICAgICAgICBzZWxlY3RlZFNjYWxlLm5vdGVzLmluY2x1ZGVzKG5vdGUubm90ZSlcbiAgICAgICAgICAgICAgPyBgPGRpdiBjbGFzcz1cIm5vdGUtdGV4dC1iYWNrZHJvcFwiPjwvZGl2PjxzcGFuIGNsYXNzPVwibm90ZS10ZXh0XCI+PHAgaWQ9JHtub3RlLmlkfT4ke25vdGUubm90ZX08L3A+PC9zcGFuPmBcbiAgICAgICAgICAgICAgOiAnJ1xuICAgICAgICAgIH08L2Rpdj5gXG4gICAgICAgIDogYDxkaXYgY2xhc3M9XCJyb290LW5vdGVcIj4ke1xuICAgICAgICAgICAgc2VsZWN0ZWRTY2FsZS5ub3Rlcy5pbmNsdWRlcyhub3RlLm5vdGUpXG4gICAgICAgICAgICAgID8gYDxidXR0b24gcm9vdE5vdGVGcmV0PVwiJHtcbiAgICAgICAgICAgICAgICAgIG5vdGUuZnJldFxuICAgICAgICAgICAgICAgIH1cIiBjbGFzcz1cInJvb3Qtbm90ZS10ZXh0LWJhY2tkcm9wIHNoYXBlLXNlbGVjdCByb290LW5vdGUtc2hhcGUtc2VsZWN0ICR7XG4gICAgICAgICAgICAgICAgICBzZWxlY3RlZFNoYXBlLm5vdGUgPT09IG5vdGUubm90ZSA/ICdzZWxlY3RlZC1yb290LW5vdGUnIDogJydcbiAgICAgICAgICAgICAgICB9XCI+PC9idXR0b24+PHNwYW4gY2xhc3M9XCJyb290LW5vdGUtdGV4dFwiPjxwIGlkPSR7bm90ZS5pZH0+JHtcbiAgICAgICAgICAgICAgICAgIG5vdGUubm90ZVxuICAgICAgICAgICAgICAgIH08L3A+PC9zcGFuPmBcbiAgICAgICAgICAgICAgOiAnJ1xuICAgICAgICAgIH08L2Rpdj5gXG4gICAgKVxuICAgIC5qb2luKCcnKX08L2Rpdj5gO1xufTtcblxuZnVuY3Rpb24gYnVpbGRLZXlTZWxlY3RvcigpIHtcbiAgbGV0IG9wdGlvbnMgPSBbXTtcbiAgZm9yIChjb25zdCBrZXlOYW1lIGluIHNjYWxlc01hcCkge1xuICAgIG9wdGlvbnMgPSBbLi4ub3B0aW9ucywgYDxvcHRpb24gdmFsdWU9XCIke2tleU5hbWV9XCI+JHtrZXlOYW1lfTwvb3B0aW9uPmBdO1xuICB9XG4gIGxldCBrZXlTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgna2V5U2VsZWN0Jyk7XG4gIGtleVNlbGVjdC5pbm5lckhUTUwgPSBvcHRpb25zLmpvaW4oKTtcbiAga2V5U2VsZWN0LnZhbHVlID0gc2VsZWN0ZWRLZXk7XG59XG5cbmZ1bmN0aW9uIGJ1aWxkU2NhbGVTZWxlY3RvcigpIHtcbiAgbGV0IG9wdGlvbnMgPSBbXTtcbiAgZm9yIChjb25zdCBzY2FsZU5hbWUgaW4gZGVncmVlc01hcCkge1xuICAgIG9wdGlvbnMgPSBbXG4gICAgICAuLi5vcHRpb25zLFxuICAgICAgYDxvcHRpb24gdmFsdWU9XCIke3NjYWxlTmFtZX1cIj4ke3NjYWxlTmFtZX08L29wdGlvbj5gXG4gICAgXTtcbiAgfVxuICBsZXQgc2NhbGVTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NhbGVTZWxlY3QnKTtcbiAgc2NhbGVTZWxlY3QuaW5uZXJIVE1MID0gb3B0aW9ucy5qb2luKCk7XG4gIHNjYWxlU2VsZWN0LnZhbHVlID0gc2VsZWN0ZWRTY2FsZURlZ3JlZXMuaWQ7XG59XG5cbmZ1bmN0aW9uIGJ1aWxkU2hhcGVTZWxlY3Qoc2hhcGVzKSB7XG4gIHNoYXBlcy5mb3JFYWNoKChzaGFwZSwgc2hhcGVJbmRleCkgPT4ge1xuICAgIGlmIChOdW1iZXIoc2hhcGVJbmRleCkgPT09IE51bWJlcihzZWxlY3RlZFNoYXBlLmluZGV4KSkge1xuICAgICAgc2VsZWN0ZWRTaGFwZSA9IHNoYXBlO1xuICAgICAgc2VsZWN0ZWRTaGFwZS5pbmRleCA9IHNoYXBlSW5kZXg7XG4gICAgfVxuICB9KTtcblxuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hhcGUtc2VsZWN0JykuaW5uZXJIVE1MID0gc2hhcGVzXG4gICAgLm1hcChcbiAgICAgIChzaGFwZSwgc2hhcGVJbmRleCkgPT5cbiAgICAgICAgYDxidXR0b24gXG4gICAgc2hhcGVJbmRleD0ke3NoYXBlSW5kZXh9XG4gICAgc2hhcGVGcmV0PSR7c2hhcGUuZnJldH0gXG4gICAgY2xhc3M9XCJzaGFwZS1zZWxlY3QgJHtcbiAgICAgIE51bWJlcihzZWxlY3RlZFNoYXBlLmluZGV4KSA9PT0gTnVtYmVyKHNoYXBlSW5kZXgpID8gJ3NlbGVjdGVkLXNoYXBlJyA6ICcnXG4gICAgfVwiPlxuICAgICR7c2hhcGUubnVtYmVyfVxuICA8L2J1dHRvbj5gXG4gICAgKVxuICAgIC5qb2luKCcnKTtcblxuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbcm9vdE5vdGVGcmV0XScpLmZvckVhY2goKGVsLCBlbGVtZW50SW5kZXgpID0+IHtcbiAgICBsZXQgdGhlU2hhcGUgPSBudWxsO1xuICAgIGxldCB0aGVTaGFwZUluZGV4ID0gbnVsbDtcbiAgICBzaGFwZXMuZm9yRWFjaCgoc2hhcGUsIGkpID0+IHtcbiAgICAgIGlmIChOdW1iZXIoZWwuZ2V0QXR0cmlidXRlKCdyb290Tm90ZUZyZXQnKSkgIT09IE51bWJlcihzaGFwZS5mcmV0KSlcbiAgICAgICAgcmV0dXJuO1xuICAgICAgdGhlU2hhcGUgPSBzaGFwZTtcbiAgICAgIHRoZVNoYXBlSW5kZXggPSBpO1xuICAgICAgaWYgKGkgIT09IHNlbGVjdGVkU2hhcGUuaW5kZXgpIHtcbiAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0ZWQtcm9vdC1ub3RlJyk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGVsLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkLXJvb3Qtbm90ZScpO1xuICAgIH0pO1xuXG4gICAgZWwuc2V0QXR0cmlidXRlKCdzaGFwZUluZGV4JywgdGhlU2hhcGVJbmRleCk7XG4gICAgZWwuc2V0QXR0cmlidXRlKCdzaGFwZU51bWJlcicsIHRoZVNoYXBlLm51bWJlcik7XG4gICAgZWwuc2V0QXR0cmlidXRlKCdzaGFwZU5vdGUnLCB0aGVTaGFwZS5ub3RlKTtcbiAgfSk7XG5cbiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNoYXBlLXNlbGVjdCcsICdbcm9vdE5vdGVGcmV0XScpLmZvckVhY2goZWwgPT5cbiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xuICAgICAgc2VsZWN0ZWRTaGFwZSA9IHtcbiAgICAgICAgaW5kZXg6IGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnc2hhcGVJbmRleCcpLFxuICAgICAgICBudW1iZXI6IGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnc2hhcGVOdW1iZXInKSxcbiAgICAgICAgZnJldDogZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdyb290Tm90ZUZyZXQnKVxuICAgICAgICAgID8gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdyb290Tm90ZUZyZXQnKVxuICAgICAgICAgIDogZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdzaGFwZUZyZXQnKSxcbiAgICAgICAgbm90ZTogZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdzaGFwZU5vdGUnKVxuICAgICAgfTtcbiAgICAgIGJ1aWxkRnJldGJvYXJkKHsgcG9ydHJhaXQ6IGlzUG9ydHJhaXQgfSk7XG4gICAgfSlcbiAgKTtcbn1cblxuZnVuY3Rpb24gcmVEcmF3QXBwKCkge1xuICBidWlsZFNjYWxlc01hcCgpO1xuICBidWlsZEtleVNlbGVjdG9yKCk7XG4gIGJ1aWxkU2NhbGVTZWxlY3RvcigpO1xuXG4gIGlmICh3aW5kb3cuaW5uZXJIZWlnaHQgPiB3aW5kb3cuaW5uZXJXaWR0aCkge1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3cmFwcGVyJykuY2xhc3NOYW1lID0gJ2FwcC13cmFwcGVyIHBvcnRyYWl0LW1vZGUnO1xuICAgIGlzUG9ydHJhaXQgPSB0cnVlO1xuICAgIGJ1aWxkRnJldGJvYXJkKHsgcG9ydHJhaXQ6IHRydWUgfSk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlzUG9ydHJhaXQgPSBmYWxzZTtcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dyYXBwZXInKS5jbGFzc05hbWUgPSAnYXBwLXdyYXBwZXIgbGFuZHNjYXBlLW1vZGUnO1xuICBidWlsZEZyZXRib2FyZCh7IHBvcnRyYWl0OiBmYWxzZSB9KTtcbn1cblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsICgpID0+IHtcbiAgcmVEcmF3QXBwKCk7XG59KTtcblxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2tleVNlbGVjdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGUgPT4ge1xuICBzZWxlY3RlZEtleSA9IGUudGFyZ2V0LnZhbHVlO1xuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgna2V5U2VsZWN0JykudmFsdWUgPSBlLnRhcmdldC52YWx1ZTtcblxuICByZURyYXdBcHAoKTtcbn0pO1xuXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NhbGVTZWxlY3QnKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBlID0+IHtcbiAgc2VsZWN0ZWRTY2FsZURlZ3JlZXMgPSBkZWdyZWVzTWFwW2UudGFyZ2V0LnZhbHVlXTtcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYWxlU2VsZWN0JykudmFsdWUgPSBlLnRhcmdldC52YWx1ZTtcblxuICByZURyYXdBcHAoKTtcbn0pO1xuXG5yZURyYXdBcHAoKTtcblxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Z1bGxTY3JlZW4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xuICBpZiAoIXNjcmVlbmZ1bGwuaXNFbmFibGVkKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHNjcmVlbmZ1bGwudG9nZ2xlKCk7XG59KTtcbiJdfQ==