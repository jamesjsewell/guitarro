"use strict";function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(b,!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(b).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}var intervals=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],standardTuningNotes=[intervals[4],intervals[9],intervals[2],intervals[7],intervals[11],intervals[4]],scalesMap={},degreesMap={major:{id:"major",degrees:[2,2,1,2,2,2,1]},minor:{id:"minor",degrees:[2,1,2,2,1,2,2]}},selectedKey=intervals[0],selectedScaleDegrees=degreesMap.major,selectedScale=null,stringsArray=[];function buildScale(a){var b=[],c=intervals.indexOf(a),d=!0,e=!1,f=void 0;try{for(var g,h,j=selectedScaleDegrees.degrees[Symbol.iterator]();!(d=(g=j.next()).done);d=!0){if(h=g.value,!intervals[c+h]){var k=c===intervals.length-1&&2===h?1:0;c=k,b=[].concat(_toConsumableArray(b),[intervals[k]]);continue}b=[].concat(_toConsumableArray(b),[intervals[c+h]]),c+=h}}catch(a){e=!0,f=a}finally{try{d||null==j["return"]||j["return"]()}finally{if(e)throw f}}return b}function buildScalesMap(){var a=!0,b=!1,c=void 0;try{for(var d,e,f=intervals[Symbol.iterator]();!(a=(d=f.next()).done);a=!0)e=d.value,scalesMap=_objectSpread({},scalesMap,_defineProperty({},e,{id:e,notes:buildScale(e)}))}catch(a){b=!0,c=a}finally{try{a||null==f["return"]||f["return"]()}finally{if(b)throw c}}selectedScale=scalesMap[selectedKey]}buildScalesMap();function getNotesOfString(a){for(var b=[],c=11===intervals.indexOf(a)?0:intervals.indexOf(a)+1;11>=b.length;)intervals[c]||(c=0),b=[].concat(_toConsumableArray(b),[intervals[c]]),c++;return b}function buildFretboard(a){var b=a.portrait,c=!0===b?[].concat(standardTuningNotes):[].concat(standardTuningNotes).reverse();document.getElementById("fretBoard").innerHTML="<div class=\"frets-edge\">".concat(buildFrets(),"</div> \n    ").concat(c.map(function(a,b){return"".concat(buildString(a)," ").concat(5>b?"<div class=\"frets\">".concat(buildFrets(b),"</div>"):"")}).join("")," \n    <div class=\"frets-edge\">").concat(buildFrets(),"</div>\n    </div>");var d=[],e=[1,7,6,5,4,3,2],f=1;stringsArray[0].map(function(a,b){var c=stringsArray[0].indexOf(selectedKey);return 0===b?(f=e[c],void(d=[f])):void(f=e[e.indexOf(f)-1],f===void 0&&(f=e[e.length-1]),d=[].concat(_toConsumableArray(d),[f]))}),console.log(d)}var buildFrets=function(a){for(var b="",c=0;12>c;c++)b+="<div class=\"fret\">".concat(2===a&&(4===c||6===c||8===c)||11===c&&(0===a||4===a)?"<div class=\"fret-dot\"></div>":"","</div>");return b},buildString=function(a){var b=getNotesOfString(a);return stringsArray=[],stringsArray=[].concat(_toConsumableArray(stringsArray),[b.filter(function(a){return selectedScale.notes.includes(a)})]),"<div class=\"guitar-string\">".concat(b.map(function(a){return"<div class=\"note\">".concat(selectedScale.notes.includes(a)?"<div class=\"note-text-backdrop\"></div><span class=\"note-text\"><p>".concat(a,"</p></span>"):"","</div>")}).join(""),"</div>")};function buildKeySelector(){var a=[];for(var c in scalesMap)a=[].concat(_toConsumableArray(a),["<option value=\"".concat(c,"\">").concat(c,"</option>")]);var b=document.getElementById("keySelect");b.innerHTML=a.join(),b.value=selectedKey}function buildScaleSelector(){var a=[];for(var c in degreesMap)a=[].concat(_toConsumableArray(a),["<option value=\"".concat(c,"\">").concat(c,"</option>")]);var b=document.getElementById("scaleSelect");b.innerHTML=a.join(),b.value=selectedScaleDegrees.id}function reDrawApp(){return buildScalesMap(),buildKeySelector(),buildScaleSelector(),window.innerHeight>window.innerWidth?(document.getElementById("wrapper").className="app-wrapper portrait-mode",void buildFretboard({portrait:!0})):void(document.getElementById("wrapper").className="app-wrapper landscape-mode",buildFretboard({portrait:!1}))}window.addEventListener("resize",function(){reDrawApp()}),document.getElementById("keySelect").addEventListener("change",function(a){selectedKey=a.target.value,document.getElementById("keySelect").value=a.target.value,reDrawApp()}),document.getElementById("scaleSelect").addEventListener("change",function(a){selectedScaleDegrees=degreesMap[a.target.value],document.getElementById("scaleSelect").value=a.target.value,reDrawApp()}),reDrawApp(),document.getElementById("fullScreen").addEventListener("click",function(){screenfull.isEnabled&&screenfull.toggle()});

//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUErQyw0QkFWNUIsQ0FXbkIsY0FBYyxDQUFDLENBQUUsUUFBUSxHQUFWLENBQUQsQ0FYSyxDQVlwQixDQUVELE1BQU0sQ0FBQyxnQkFBUCxDQUF3QixRQUF4QixDQUFrQyxVQUFNLENBQ3RDLFNBQVMsRUFDVixDQUZELEMsQ0FJQSxRQUFRLENBQUMsY0FBVCxDQUF3QixXQUF4QixFQUFxQyxnQkFBckMsQ0FBc0QsUUFBdEQsQ0FBZ0UsU0FBQSxDQUFDLENBQUksQ0FDbkUsV0FBVyxDQUFHLENBQUMsQ0FBQyxNQUFGLENBQVMsS0FENEMsQ0FFbkUsUUFBUSxDQUFDLGNBQVQsQ0FBd0IsV0FBeEIsRUFBcUMsS0FBckMsQ0FBNkMsQ0FBQyxDQUFDLE1BQUYsQ0FBUyxLQUZhLENBSW5FLFNBQVMsRUFDVixDQUxELEMsQ0FPQSxRQUFRLENBQUMsY0FBVCxDQUF3QixhQUF4QixFQUF1QyxnQkFBdkMsQ0FBd0QsUUFBeEQsQ0FBa0UsU0FBQSxDQUFDLENBQUksQ0FDckUsb0JBQW9CLENBQUcsVUFBVSxDQUFDLENBQUMsQ0FBQyxNQUFGLENBQVMsS0FBVixDQURvQyxDQUVyRSxRQUFRLENBQUMsY0FBVCxDQUF3QixhQUF4QixFQUF1QyxLQUF2QyxDQUErQyxDQUFDLENBQUMsTUFBRixDQUFTLEtBRmEsQ0FJckUsU0FBUyxFQUNWLENBTEQsQyxDQU9BLFNBQVMsRSxDQUVULFFBQVEsQ0FBQyxjQUFULENBQXdCLFlBQXhCLEVBQXNDLGdCQUF0QyxDQUF1RCxPQUF2RCxDQUFnRSxVQUFLLENBQzlELFVBQVUsQ0FBQyxTQURtRCxFQUluRSxVQUFVLENBQUMsTUFBWCxFQUNELENBTEQsQyIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGludGVydmFscyA9IFtcbiAgJ0MnLFxuICAnQyMnLFxuICAnRCcsXG4gICdEIycsXG4gICdFJyxcbiAgJ0YnLFxuICAnRiMnLFxuICAnRycsXG4gICdHIycsXG4gICdBJyxcbiAgJ0EjJyxcbiAgJ0InXG5dO1xuXG5jb25zdCBzdGFuZGFyZFR1bmluZ05vdGVzID0gW1xuICBpbnRlcnZhbHNbNF0sXG4gIGludGVydmFsc1s5XSxcbiAgaW50ZXJ2YWxzWzJdLFxuICBpbnRlcnZhbHNbN10sXG4gIGludGVydmFsc1sxMV0sXG4gIGludGVydmFsc1s0XVxuXTtcblxubGV0IHNjYWxlc01hcCA9IHt9O1xuXG5jb25zdCBkZWdyZWVzTWFwID0ge1xuICBtYWpvcjogeyBpZDogJ21ham9yJywgZGVncmVlczogWzIsIDIsIDEsIDIsIDIsIDIsIDFdIH0sXG4gIG1pbm9yOiB7IGlkOiAnbWlub3InLCBkZWdyZWVzOiBbMiwgMSwgMiwgMiwgMSwgMiwgMl0gfVxufTtcblxubGV0IHNlbGVjdGVkS2V5ID0gaW50ZXJ2YWxzWzBdO1xubGV0IHNlbGVjdGVkU2NhbGVEZWdyZWVzID0gZGVncmVlc01hcC5tYWpvcjtcbmxldCBzZWxlY3RlZFNjYWxlID0gbnVsbDtcblxubGV0IHN0cmluZ3NBcnJheSA9IFtdO1xuXG5mdW5jdGlvbiBidWlsZFNjYWxlKHJvb3ROb3RlKSB7XG4gIGxldCBzY2FsZSA9IFtdO1xuXG4gIGxldCBpID0gaW50ZXJ2YWxzLmluZGV4T2Yocm9vdE5vdGUpO1xuICBmb3IgKGNvbnN0IGRlZ3JlZSBvZiBzZWxlY3RlZFNjYWxlRGVncmVlcy5kZWdyZWVzKSB7XG4gICAgaWYgKCFpbnRlcnZhbHNbaSArIGRlZ3JlZV0pIHtcbiAgICAgIGxldCBzdGFydEluZGV4ID0gaSA9PT0gaW50ZXJ2YWxzLmxlbmd0aCAtIDEgJiYgZGVncmVlID09PSAyID8gMSA6IDA7XG4gICAgICBpID0gc3RhcnRJbmRleDtcbiAgICAgIHNjYWxlID0gWy4uLnNjYWxlLCBpbnRlcnZhbHNbc3RhcnRJbmRleF1dO1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgc2NhbGUgPSBbLi4uc2NhbGUsIGludGVydmFsc1tpICsgZGVncmVlXV07XG5cbiAgICBpICs9IGRlZ3JlZTtcbiAgfVxuICByZXR1cm4gc2NhbGU7XG59XG5cbmZ1bmN0aW9uIGJ1aWxkU2NhbGVzTWFwKCkge1xuICBmb3IgKGxldCBpbnRlcnZhbCBvZiBpbnRlcnZhbHMpIHtcbiAgICBzY2FsZXNNYXAgPSB7XG4gICAgICAuLi5zY2FsZXNNYXAsXG4gICAgICBbaW50ZXJ2YWxdOiB7IGlkOiBpbnRlcnZhbCwgbm90ZXM6IGJ1aWxkU2NhbGUoaW50ZXJ2YWwpIH1cbiAgICB9O1xuICB9XG4gIHNlbGVjdGVkU2NhbGUgPSBzY2FsZXNNYXBbc2VsZWN0ZWRLZXldO1xufVxuXG5idWlsZFNjYWxlc01hcCgpO1xuXG5mdW5jdGlvbiBnZXROb3Rlc09mU3RyaW5nKHN0YXJ0aW5nTm90ZSkge1xuICBsZXQgbm90ZXMgPSBbXTtcbiAgbGV0IGkgPVxuICAgIGludGVydmFscy5pbmRleE9mKHN0YXJ0aW5nTm90ZSkgPT09IDExXG4gICAgICA/IDBcbiAgICAgIDogaW50ZXJ2YWxzLmluZGV4T2Yoc3RhcnRpbmdOb3RlKSArIDE7XG5cbiAgd2hpbGUgKG5vdGVzLmxlbmd0aCA8PSAxMSkge1xuICAgIGlmICghaW50ZXJ2YWxzW2ldKSB7XG4gICAgICBpID0gMDtcbiAgICB9XG4gICAgbm90ZXMgPSBbLi4ubm90ZXMsIGludGVydmFsc1tpXV07XG4gICAgaSsrO1xuICB9XG5cbiAgcmV0dXJuIG5vdGVzO1xufVxuXG5mdW5jdGlvbiBidWlsZEZyZXRib2FyZCh7IHBvcnRyYWl0IH0pIHtcbiAgY29uc3Qgc3RhcnRpbmdOb3RlcyA9XG4gICAgcG9ydHJhaXQgPT09IHRydWVcbiAgICAgID8gWy4uLnN0YW5kYXJkVHVuaW5nTm90ZXNdXG4gICAgICA6IFsuLi5zdGFuZGFyZFR1bmluZ05vdGVzXS5yZXZlcnNlKCk7XG5cbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXG4gICAgJ2ZyZXRCb2FyZCdcbiAgKS5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz1cImZyZXRzLWVkZ2VcIj4ke2J1aWxkRnJldHMoKX08L2Rpdj4gXG4gICAgJHtzdGFydGluZ05vdGVzXG4gICAgICAubWFwKFxuICAgICAgICAoc3RhcnRpbmdOb3RlLCBzdHJpbmdOdW1iZXIpID0+XG4gICAgICAgICAgYCR7YnVpbGRTdHJpbmcoc3RhcnRpbmdOb3RlKX0gJHtcbiAgICAgICAgICAgIHN0cmluZ051bWJlciA8IDVcbiAgICAgICAgICAgICAgPyBgPGRpdiBjbGFzcz1cImZyZXRzXCI+JHtidWlsZEZyZXRzKHN0cmluZ051bWJlcil9PC9kaXY+YFxuICAgICAgICAgICAgICA6ICcnXG4gICAgICAgICAgfWBcbiAgICAgIClcbiAgICAgIC5qb2luKCcnKX0gXG4gICAgPGRpdiBjbGFzcz1cImZyZXRzLWVkZ2VcIj4ke2J1aWxkRnJldHMoKX08L2Rpdj5cbiAgICA8L2Rpdj5gO1xuXG4gIGxldCBzaGFwZXMgPSBbXTtcbiAgY29uc3Qgc2hhcGVOdW1iZXJzID0gWzEsIDcsIDYsIDUsIDQsIDMsIDJdO1xuICBsZXQgY3VycmVudFNoYXBlID0gMTtcblxuICBzdHJpbmdzQXJyYXlbMF0ubWFwKChub3RlLCBub3RlSW5kZXgpID0+IHtcbiAgICBjb25zdCByb290Tm90ZUluZGV4ID0gc3RyaW5nc0FycmF5WzBdLmluZGV4T2Yoc2VsZWN0ZWRLZXkpO1xuXG4gICAgaWYgKG5vdGVJbmRleCA9PT0gMCkge1xuICAgICAgY3VycmVudFNoYXBlID0gc2hhcGVOdW1iZXJzW3Jvb3ROb3RlSW5kZXhdO1xuICAgICAgc2hhcGVzID0gW2N1cnJlbnRTaGFwZV07XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY3VycmVudFNoYXBlID0gc2hhcGVOdW1iZXJzW3NoYXBlTnVtYmVycy5pbmRleE9mKGN1cnJlbnRTaGFwZSkgLSAxXTtcblxuICAgIGlmIChjdXJyZW50U2hhcGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgY3VycmVudFNoYXBlID0gc2hhcGVOdW1iZXJzW3NoYXBlTnVtYmVycy5sZW5ndGggLSAxXTtcbiAgICB9XG5cbiAgICBzaGFwZXMgPSBbLi4uc2hhcGVzLCBjdXJyZW50U2hhcGVdO1xuICB9KTtcblxuICBjb25zb2xlLmxvZyhzaGFwZXMpO1xufVxuXG5jb25zdCBidWlsZEZyZXRzID0gc3RyaW5nTnVtYmVyID0+IHtcbiAgbGV0IGZyZXRzID0gYGA7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgMTI7IGkrKykge1xuICAgIGZyZXRzICs9IGA8ZGl2IGNsYXNzPVwiZnJldFwiPiR7XG4gICAgICAoc3RyaW5nTnVtYmVyID09PSAyICYmIChpID09PSA0IHx8IGkgPT09IDYgfHwgaSA9PT0gOCkpIHx8XG4gICAgICAoaSA9PT0gMTEgJiYgKHN0cmluZ051bWJlciA9PT0gMCB8fCBzdHJpbmdOdW1iZXIgPT09IDQpKVxuICAgICAgICA/IGA8ZGl2IGNsYXNzPVwiZnJldC1kb3RcIj48L2Rpdj5gXG4gICAgICAgIDogJydcbiAgICB9PC9kaXY+YDtcbiAgfVxuICByZXR1cm4gZnJldHM7XG59O1xuXG5jb25zdCBidWlsZFN0cmluZyA9IHN0YXJ0aW5nTm90ZSA9PiB7XG4gIGNvbnN0IHN0cmluZ05vdGVzID0gZ2V0Tm90ZXNPZlN0cmluZyhzdGFydGluZ05vdGUpO1xuICBzdHJpbmdzQXJyYXkgPSBbXTtcbiAgc3RyaW5nc0FycmF5ID0gW1xuICAgIC4uLnN0cmluZ3NBcnJheSxcbiAgICBzdHJpbmdOb3Rlcy5maWx0ZXIobm90ZSA9PiBzZWxlY3RlZFNjYWxlLm5vdGVzLmluY2x1ZGVzKG5vdGUpKVxuICBdO1xuXG4gIHJldHVybiBgPGRpdiBjbGFzcz1cImd1aXRhci1zdHJpbmdcIj4ke3N0cmluZ05vdGVzXG4gICAgLm1hcChcbiAgICAgIG5vdGUgPT5cbiAgICAgICAgYDxkaXYgY2xhc3M9XCJub3RlXCI+JHtcbiAgICAgICAgICBzZWxlY3RlZFNjYWxlLm5vdGVzLmluY2x1ZGVzKG5vdGUpXG4gICAgICAgICAgICA/IGA8ZGl2IGNsYXNzPVwibm90ZS10ZXh0LWJhY2tkcm9wXCI+PC9kaXY+PHNwYW4gY2xhc3M9XCJub3RlLXRleHRcIj48cD4ke25vdGV9PC9wPjwvc3Bhbj5gXG4gICAgICAgICAgICA6ICcnXG4gICAgICAgIH08L2Rpdj5gXG4gICAgKVxuICAgIC5qb2luKCcnKX08L2Rpdj5gO1xufTtcblxuZnVuY3Rpb24gYnVpbGRLZXlTZWxlY3RvcigpIHtcbiAgbGV0IG9wdGlvbnMgPSBbXTtcbiAgZm9yIChjb25zdCBrZXlOYW1lIGluIHNjYWxlc01hcCkge1xuICAgIG9wdGlvbnMgPSBbLi4ub3B0aW9ucywgYDxvcHRpb24gdmFsdWU9XCIke2tleU5hbWV9XCI+JHtrZXlOYW1lfTwvb3B0aW9uPmBdO1xuICB9XG4gIGxldCBrZXlTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgna2V5U2VsZWN0Jyk7XG4gIGtleVNlbGVjdC5pbm5lckhUTUwgPSBvcHRpb25zLmpvaW4oKTtcbiAga2V5U2VsZWN0LnZhbHVlID0gc2VsZWN0ZWRLZXk7XG59XG5cbmZ1bmN0aW9uIGJ1aWxkU2NhbGVTZWxlY3RvcigpIHtcbiAgbGV0IG9wdGlvbnMgPSBbXTtcbiAgZm9yIChjb25zdCBzY2FsZU5hbWUgaW4gZGVncmVlc01hcCkge1xuICAgIG9wdGlvbnMgPSBbXG4gICAgICAuLi5vcHRpb25zLFxuICAgICAgYDxvcHRpb24gdmFsdWU9XCIke3NjYWxlTmFtZX1cIj4ke3NjYWxlTmFtZX08L29wdGlvbj5gXG4gICAgXTtcbiAgfVxuICBsZXQgc2NhbGVTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NhbGVTZWxlY3QnKTtcbiAgc2NhbGVTZWxlY3QuaW5uZXJIVE1MID0gb3B0aW9ucy5qb2luKCk7XG4gIHNjYWxlU2VsZWN0LnZhbHVlID0gc2VsZWN0ZWRTY2FsZURlZ3JlZXMuaWQ7XG59XG5cbmZ1bmN0aW9uIHJlRHJhd0FwcCgpIHtcbiAgYnVpbGRTY2FsZXNNYXAoKTtcbiAgYnVpbGRLZXlTZWxlY3RvcigpO1xuICBidWlsZFNjYWxlU2VsZWN0b3IoKTtcblxuICBpZiAod2luZG93LmlubmVySGVpZ2h0ID4gd2luZG93LmlubmVyV2lkdGgpIHtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd3JhcHBlcicpLmNsYXNzTmFtZSA9ICdhcHAtd3JhcHBlciBwb3J0cmFpdC1tb2RlJztcbiAgICBidWlsZEZyZXRib2FyZCh7IHBvcnRyYWl0OiB0cnVlIH0pO1xuICAgIHJldHVybjtcbiAgfVxuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd3JhcHBlcicpLmNsYXNzTmFtZSA9ICdhcHAtd3JhcHBlciBsYW5kc2NhcGUtbW9kZSc7XG4gIGJ1aWxkRnJldGJvYXJkKHsgcG9ydHJhaXQ6IGZhbHNlIH0pO1xufVxuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgKCkgPT4ge1xuICByZURyYXdBcHAoKTtcbn0pO1xuXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgna2V5U2VsZWN0JykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZSA9PiB7XG4gIHNlbGVjdGVkS2V5ID0gZS50YXJnZXQudmFsdWU7XG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdrZXlTZWxlY3QnKS52YWx1ZSA9IGUudGFyZ2V0LnZhbHVlO1xuXG4gIHJlRHJhd0FwcCgpO1xufSk7XG5cbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2FsZVNlbGVjdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGUgPT4ge1xuICBzZWxlY3RlZFNjYWxlRGVncmVlcyA9IGRlZ3JlZXNNYXBbZS50YXJnZXQudmFsdWVdO1xuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NhbGVTZWxlY3QnKS52YWx1ZSA9IGUudGFyZ2V0LnZhbHVlO1xuXG4gIHJlRHJhd0FwcCgpO1xufSk7XG5cbnJlRHJhd0FwcCgpO1xuXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZnVsbFNjcmVlbicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XG4gIGlmICghc2NyZWVuZnVsbC5pc0VuYWJsZWQpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgc2NyZWVuZnVsbC50b2dnbGUoKTtcbn0pO1xuIl19